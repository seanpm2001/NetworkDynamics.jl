<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic differential equations · NetworkDynamics</title><meta name="title" content="Stochastic differential equations · NetworkDynamics"/><meta property="og:title" content="Stochastic differential equations · NetworkDynamics"/><meta property="twitter:title" content="Stochastic differential equations · NetworkDynamics"/><meta name="description" content="Documentation for NetworkDynamics."/><meta property="og:description" content="Documentation for NetworkDynamics."/><meta property="twitter:description" content="Documentation for NetworkDynamics."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">NetworkDynamics</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">General</a></li><li><a class="tocitem" href="../../Library/">API</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started_with_network_dynamics/">Getting started</a></li><li><a class="tocitem" href="../directed_and_weighted_graphs/">Directed and weighted graphs</a></li><li><a class="tocitem" href="../heterogeneous_system/">Heterogeneous systems</a></li><li class="is-active"><a class="tocitem" href>Stochastic differential equations</a><ul class="internal"><li><a class="tocitem" href="#Example:-Fluctuations-in-Power-Grids"><span>Example: Fluctuations in Power Grids</span></a></li><li><a class="tocitem" href="#Implementing-the-Swing-Equation"><span>Implementing the Swing Equation</span></a></li><li><a class="tocitem" href="#Contructing-the-Deterministic-Dynamics"><span>Contructing the Deterministic Dynamics</span></a></li><li><a class="tocitem" href="#Fixpoint-Search"><span>Fixpoint Search</span></a></li><li><a class="tocitem" href="#Adding-a-Stochastic-Layer"><span>Adding a Stochastic Layer</span></a></li><li><a class="tocitem" href="#Simulating-the-SDE"><span>Simulating the SDE</span></a></li></ul></li><li><a class="tocitem" href="../cascading_failure/">Cascading failure</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Stochastic differential equations</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stochastic differential equations</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/PIK-ICoNe/NetworkDynamics.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/PIK-ICoNe/NetworkDynamics.jl/blob/main/docs/examples/StochasticSystem.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="SDE-Tutorial"><a class="docs-heading-anchor" href="#SDE-Tutorial">SDE Tutorial</a><a id="SDE-Tutorial-1"></a><a class="docs-heading-anchor-permalink" href="#SDE-Tutorial" title="Permalink"></a></h1><p>This example can be dowloaded as a normal Julia script <a href="../StochasticSystem.jl">here</a>.</p><h4 id="Topics-covered-in-this-tutorial-include:"><a class="docs-heading-anchor" href="#Topics-covered-in-this-tutorial-include:">Topics covered in this tutorial include:</a><a id="Topics-covered-in-this-tutorial-include:-1"></a><a class="docs-heading-anchor-permalink" href="#Topics-covered-in-this-tutorial-include:" title="Permalink"></a></h4><ul><li>the swing equation</li><li>fixpoint search of ODE systems</li><li>constructing an SDE problem with NetworkDynamics.jl</li></ul><h2 id="Example:-Fluctuations-in-Power-Grids"><a class="docs-heading-anchor" href="#Example:-Fluctuations-in-Power-Grids">Example: Fluctuations in Power Grids</a><a id="Example:-Fluctuations-in-Power-Grids-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Fluctuations-in-Power-Grids" title="Permalink"></a></h2><p>This tutorial explains the use of stochastic differential equations (SDE&#39;s) in NetworkDynamics.jl. As an example system we will simulate fluctuations in a simple power grid model.</p><p>The phase and frequency dynamics in power grids can be modeled by the swing equation. In the complex systems community this is also known as the Kuramoto model with inertia.</p><p class="math-container">\[\begin{aligned}
\dot \theta_i &amp;= \omega_i \\
M_i \dot \omega_i &amp;= P_i(t) - D_i \omega_i - \sum_{i=1}^N K_{ij} \sin(\theta_i - \theta_j)
\end{aligned}\]</p><p>Here, <span>$M_i$</span> and <span>$D_i$</span> are inertia and damping parameters, <span>$K_{ij}$</span> is the power capacitiy of the line and <span>$P_i(t)$</span> is the power infeed at the node. We assume that this power can be separated into a constant power setpoint <span>$P^\circ_i$</span> and a stochastic fluctuation.</p><p class="math-container">\[\begin{aligned}
P_i(t) = P^\circ_i + \sigma_i \cdot \xi_i(t)
\end{aligned}\]</p><p>In this tutorial we assume the fluctuations <span>$\xi_i(t)$</span> to be white Gaussian noise. Separating the deterministic and stochastic part, we can write this problem as a stochastic differential equation.</p><p class="math-container">\[\begin{aligned}
d\omega_i = \left[P_i - D_i \omega_i - \sum_{i=1}^N K_{ij} \sin(\theta_i - \theta_j)\right] dt + \sigma_i dW_i
\end{aligned}\]</p><p>Here, <span>$dW_i = \xi_i dt$</span> is the infinitesimal increment of the Wiener process. Problems of this type can be numerically solved in Julia as described in the <a href="https://diffeq.sciml.ai/stable/tutorials/sde_example/">SDE Tutorial</a> of <code>DifferentialEquations</code>.</p><h2 id="Implementing-the-Swing-Equation"><a class="docs-heading-anchor" href="#Implementing-the-Swing-Equation">Implementing the Swing Equation</a><a id="Implementing-the-Swing-Equation-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-the-Swing-Equation" title="Permalink"></a></h2><p>First we will implement the node and edge functions for the deterministic case without the fluctuations. We set the defaults for the inertia and damping parameters to be <span>$M_i = 1.0$</span> and <span>$D_i = 0.1$</span>. The default coupling strength is <span>$K=6$</span>.</p><pre><code class="language-julia hljs">using NetworkDynamics, Graphs
using StochasticDiffEq, OrdinaryDiffEq
using Plots, LaTeXStrings

function swing_equation!(dv, v, esum, (M, P, D), t)
    dv[1] = v[2]
    dv[2] = 1/M *(P - D * v[2] + esum[1])
    nothing
end
swing_vertex = ODEVertex(swing_equation!; sym=[:θ, :ω], psym=[:M=&gt;1, :P, :D=&gt;0.1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ODEVertex :ODEVertex with depth <span class="sgr94">2</span>
 ├─ 2 states: [θ, ω]
 └─ 3 params: [M=1.0, P, D=0.1]</code></pre><pre><code class="language-julia hljs">function powerflow!(e, v_s, v_d, (K,), t)
    e[1] = K * sin(v_s[1] - v_d[1])
end
powerflow_edge = StaticEdge(powerflow!; dim=1, psym=[:K=&gt;6], coupling=AntiSymmetric())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StaticEdge :StaticEdge with <span class="sgr94">AntiSymmetric</span> coupling of depth <span class="sgr93">1</span>
 ├─ 1 state: [e]
 └─ 1 param: [K=6.0]</code></pre><h2 id="Contructing-the-Deterministic-Dynamics"><a class="docs-heading-anchor" href="#Contructing-the-Deterministic-Dynamics">Contructing the Deterministic Dynamics</a><a id="Contructing-the-Deterministic-Dynamics-1"></a><a class="docs-heading-anchor-permalink" href="#Contructing-the-Deterministic-Dynamics" title="Permalink"></a></h2><p>For the graph structure we will use a simple 4 node ring network.</p><pre><code class="language-julia hljs">g = watts_strogatz(4, 2, 0.0)</code></pre><p>Then we can construct the <code>Network</code> of the deterministic system.</p><pre><code class="language-julia hljs">nd = Network(g, swing_vertex, powerflow_edge)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Dynamic network with:
 ├─ 4 vertices (1 unique type)
 └─ 4 edges (1 unique type)
Edge-Aggregation using SequentialAggregator(+)
 ├─ vertices receive edge states 1:1 (edge depth = 1)
 └─ edges receive vertex states  1:2 (vertex depth = 2)</code></pre><h2 id="Fixpoint-Search"><a class="docs-heading-anchor" href="#Fixpoint-Search">Fixpoint Search</a><a id="Fixpoint-Search-1"></a><a class="docs-heading-anchor-permalink" href="#Fixpoint-Search" title="Permalink"></a></h2><p>Now we need to define the dynamic parameters of vertices and edges. For that, we start by creating the <code>NWParameter</code> object, pre filling it with the default values:</p><pre><code class="language-julia hljs">p = NWParameter(nd)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Parameter{Vector{Float64}} of Dynamic network (4 vertices, 4 edges)
  ├─ VPIndex(1, :M) =&gt; 1.0
  ├─ VPIndex(1, :P) =&gt; NaN
  ├─ VPIndex(1, :D) =&gt; 0.1
  ├─ VPIndex(2, :M) =&gt; 1.0
  ├─ VPIndex(2, :P) =&gt; NaN
  ├─ VPIndex(2, :D) =&gt; 0.1
  ├─ VPIndex(3, :M) =&gt; 1.0
  ├─ VPIndex(3, :P) =&gt; NaN
  ├─ VPIndex(3, :D) =&gt; 0.1
  ├─ VPIndex(4, :M) =&gt; 1.0
  ├─ VPIndex(4, :P) =&gt; NaN
  ├─ VPIndex(4, :D) =&gt; 0.1
  ├─ EPIndex(1, :K) =&gt; 6.0
  ├─ EPIndex(2, :K) =&gt; 6.0
  ├─ EPIndex(3, :K) =&gt; 6.0
  └─ EPIndex(4, :K) =&gt; 6.0</code></pre><p>Most of the parameters are allready set For the nodes we assume half of them to be net producers (<span>$P = 1.0$</span>) and half of them to be net consumers (<span>$P = -1.0$</span>) of power.</p><pre><code class="language-julia hljs">p.v[1:4, :P] = [1, -1, 1, -1]</code></pre><p>We want to simulate fluctuations around an equilibrium state of our model system. Therefore, we need to find a fixpoint of the determinitic system which can be done by using the utility function <code>find_fixpoint()</code>. As an initial guess we take all variables equal to zero.</p><pre><code class="language-julia hljs">u0 = find_fixpoint(nd, p)

ode_prob = ODEProblem(nd, uflat(u0), (0.0, 500.0), pflat(p))
ode_sol = solve(ode_prob, Tsit5())

plot(ode_sol; idxs=vidxs(nd,:,:ω), ylims=(-1.0, 1.0), ylabel=L&quot;\omega&quot;, legend=false, fmt=:png)</code></pre><img src="377b81de.svg" alt="Example block output"/><p>We see that this is in fact a fixpoint solution. We will later use this as an initial condition for the numerical integration of the SDE system.</p><h2 id="Adding-a-Stochastic-Layer"><a class="docs-heading-anchor" href="#Adding-a-Stochastic-Layer">Adding a Stochastic Layer</a><a id="Adding-a-Stochastic-Layer-1"></a><a class="docs-heading-anchor-permalink" href="#Adding-a-Stochastic-Layer" title="Permalink"></a></h2><p>For adding the stochastic part of the dynamics we have to define a second graph layer. In our example, the fluctuations at different nodes are independent of each other. Therefore, we define a second graph with the same number of vertices but without any edges.</p><pre><code class="language-julia hljs">h = SimpleGraph(4, 0)</code></pre><p>The dynamics at the nodes has to have the same dimension as in the deterministic case. In our example we only have fluctuations in the second variable.</p><pre><code class="language-julia hljs">function fluctuation!(dx, x, edges, p, t)
    dx[1] = 0.0
    dx[2] = 0.05
end</code></pre><p>Now we can construct the dynamics of the second layer by using <code>network_dynamics()</code>. Since the graph structure of the stochastic layer has no edges we can take the edge function of the deterministic case as a placeholder.</p><pre><code class="language-julia hljs">fluctuation_vertex = ODEVertex(fluctuation!; dim=2)
nd_noise = Network(h, fluctuation_vertex, NetworkDynamics.EdgeFunction[])</code></pre><h2 id="Simulating-the-SDE"><a class="docs-heading-anchor" href="#Simulating-the-SDE">Simulating the SDE</a><a id="Simulating-the-SDE-1"></a><a class="docs-heading-anchor-permalink" href="#Simulating-the-SDE" title="Permalink"></a></h2><p>Finally, we can create an <code>SDEProblem</code> and solve it with <code>DifferentialEquations</code>.</p><pre><code class="language-julia hljs">sde_prob = SDEProblem(nd, nd_noise, uflat(u0), (0.0, 500.0), pflat(p))
sde_sol = solve(sde_prob, SOSRA())
plot(sde_sol; idxs=vidxs(nd,:,:ω), ylims=(-1.0, 1.0), ylabel=L&quot;\omega&quot;, legend=false, fmt=:png)</code></pre><img src="266fa112.svg" alt="Example block output"/><p>More details on SDE problems, e.g. how to include correlations or how to define an <code>EnsembleProblem</code>, can be found in the <a href="https://diffeq.sciml.ai/stable/types/sde_types/">documentation</a> of <code>DifferentialEquations</code>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../heterogeneous_system/">« Heterogeneous systems</a><a class="docs-footer-nextpage" href="../cascading_failure/">Cascading failure »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Tuesday 9 July 2024 15:48">Tuesday 9 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
